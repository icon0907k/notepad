# **요청-응답 흐름 상세 정리**

## **1. 공통 단계**

`GET`과 `POST` 요청 모두에서 아래 단계는 동일합니다:

1. **클라이언트 → WAS**
    
    - 클라이언트가 HTTP 요청(`GET`, `POST`)을 전송.
    - WAS는 요청을 받아 내부 처리 흐름을 시작.
2. **WAS → 필터 (Filter)**
    
    - 필터는 요청/응답의 전처리 및 후처리를 수행.
        - 예: 인증, 로깅, CORS 처리.
    - 여러 필터는 체인 방식으로 순차적으로 처리.
3. **필터 → 인터셉터 (Interceptor)**
    
    - 인터셉터는 컨트롤러 실행 전/후 추가 로직을 수행.
        - `preHandle`: 요청 검증 등 처리.
        - `postHandle`: 컨트롤러 실행 후 응답 수정 가능.
        - `afterCompletion`: 최종적으로 요청 처리 완료 후 실행.

---

## **2. 요청별 처리 흐름**

### **2.1. POST 요청 흐름**

1. **인터셉터 → 컨트롤러 (Controller)**
    - 요청 URL에 매핑된 컨트롤러가 실행 준비.
2. **컨트롤러 → 아그리먼트 리졸버 (Argument Resolver)**
    - 컨트롤러 메서드의 파라미터를 생성.
        - **메시지 컨버터**를 사용해 HTTP 요청 데이터를 Java 객체로 변환.
            - 예: JSON → Java 객체 (`@RequestBody`), XML 변환 등.
3. **아그리먼트 리졸버 → 메시지 컨버터 (Message Converter)**
    - 메시지 컨버터가 HTTP 요청 본문을 읽어 Java 객체로 변환.
        - **POST 요청 본문에 데이터가 포함**되어 있기 때문.
4. **컨트롤러 메서드 실행**
    - 컨트롤러가 비즈니스 로직을 처리하고 결과 반환.
5. **메서드 리턴 → 리턴 밸류 핸들러 (Return Value Handler)**
    - 메서드 반환값을 HTTP 응답에 맞게 처리.
        - 예: Java 객체 → JSON (`@ResponseBody`).
6. **리턴 밸류 핸들러 → 인터셉터**
    - 응답 데이터를 후처리.
7. **인터셉터 → 필터 → WAS → 클라이언트**
    - 응답 데이터를 클라이언트로 전송.

---
### **2.2. GET 요청 흐름**

1. **인터셉터 → 컨트롤러 (Controller)**
    - 요청 URL에 매핑된 컨트롤러가 실행 준비.
2. **컨트롤러 → 아그리먼트 리졸버 (Argument Resolver)**
    - 요청 데이터로 컨트롤러 메서드 파라미터를 생성.
        - **컨버전 서비스 (Conversion Service)**가 사용됨.
            - 예: `String → Integer`, `String → Enum` 등의 타입 변환.
        - 요청 본문 데이터가 없기 때문에 메시지 컨버터는 사용되지 않음.
3. **컨트롤러 메서드 실행**
    - 컨트롤러가 비즈니스 로직을 처리하고 결과 반환.
4. **메서드 리턴 → 리턴 밸류 핸들러 (Return Value Handler)**
    - 메서드 반환값을 HTTP 응답에 맞게 처리.
        - 이 과정에서 **컨버전 서비스**가 사용될 수 있음.
            - 예: Java 객체 → JSON, Java 객체 → XML 등.
5. **리턴 밸류 핸들러 → 인터셉터**
    - 응답 데이터를 후처리.
6. **인터셉터 → 필터 → WAS → 클라이언트**
    - 응답 데이터를 클라이언트로 전송.

---

## **3. 메시지 컨버터와 컨버전 서비스 차이**

| **구분**       | **메시지 컨버터 (Message Converter)**                                   | **컨버전 서비스 (Conversion Service)**                       |
| ------------ | ----------------------------------------------------------------- | ------------------------------------------------------ |
| **사용 시점**    | 주로 **POST 요청**에서 사용. 요청 본문 데이터를 Java 객체로 변환.                      | 주로 **GET 요청**에서 사용. 요청 파라미터(String)를 필요한 타입으로 변환.      |
| **처리 대상**    | HTTP 요청/응답 본문 데이터 (JSON, XML 등).                                  | HTTP 요청 URL 또는 쿼리 파라미터 (String).                       |
| **주요 애노테이션** | `@RequestBody`, `@ResponseBody`.                                  | `@RequestParam`, `@PathVariable`, `@ModelAttribute` 등. |
| **예제**       | JSON → Java 객체 변환 (`POST`).                                       | `String → Integer`, `String → Enum` 변환 (`GET`).        |
| **스프링 역할**   | 메시지 컨버터는 HTTP 요청 본문을 읽고 Java 객체로 변환하거나, Java 객체를 HTTP 응답 본문으로 변환. | 컨버전 서비스는 스프링의 타입 변환 프레임워크를 통해 String 데이터를 원하는 타입으로 변환. |

---
## **4. 요청-응답 흐름 요약**

### **POST 요청**
```java
클라이언트 → WAS → 필터 → 인터셉터 → 컨트롤러 
         → 아그리먼트 리졸버 → 메시지 컨버터 → 컨트롤러 메서드 
         → 리턴 밸류 핸들러 → 인터셉터 → 필터 → WAS → 클라이언트

```
### **GET 요청**
```java
클라이언트 → WAS → 필터 → 인터셉터 → 컨트롤러 
         → 아그리먼트 리졸버 (컨버전 서비스) → 컨트롤러 메서드 
         → 리턴 밸류 핸들러 (컨버전 서비스) → 인터셉터 → 필터 → WAS → 클라이언트
```